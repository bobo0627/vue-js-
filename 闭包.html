<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        /**
         * 闭包特性
         * 1.函数嵌套函数
         * 2.函数内部可以引用函数外部的参数 变量
         * 3.参数和变量不会被垃圾回收机制回收
         * 
         * 闭包优点
         * 1.属性私有化
         * 2.防止变量污染
         * 
         * 闭包缺点
         * 1.容易造成内存泄漏
         * **/
        //函数嵌套函数的 闭包
        function aa(){
            var a = 1;
            return function(){
                console.log(a++)
            }
        }
        var fun1 = aa()
        console.log(fun1)
        fun1()//1
        fun1()//2
        fun1()//3
        //闭包会使变量始终保存在内存中，如果不当使用会增大内存消耗。
        /**
         * javascript的垃圾回收原理
         * 1.在javascript中，如果一个对象不再被引用，那么这个对象就会被GC回收；
         * 2.如果两个对象互相引用，而不再被第3者所引用，那么这两个互相引用的对象也会被回收。
        */

        //全局变量的累加
        var a1 = 1
        function aa1(){
            a1++;
            console.log(a1);
        }
        aa1()//2     a1 为全局变量
        aa1()//3
        //局部变量， 
        function aa2(){
            var a2 = 1;
            a2++;
            console.log(a2)
        }
        aa2()//2
        aa2()//2  局部没有累加，每次调用aa2() 函数，都会从新 var 一个a2,之前的已经销毁

        //局部变量累加
        function aa3(){
            var a3 = 10;
            return function(){
                console.log(++a3)
            }
        }
        var faa3 = aa3()
        faa3()//11
        faa3()//12
        
        //匿名函数
        var abc = (function(){
            var aa4 = 1;
            return function(){
                console.log(++aa4)
            }
        })()
        abc()//2
        abc()//3
        // 私有成员的存在
        var pri = (function(){
            var aa5 = 1;
            function aaa(){
                aa5++;
                console.log(aa5)
            }
            function bbb(){
                aa5++;
                console.log(aa5)
            }
            return {
                a:aaa,
                b:bbb
            }
        })()
        console.log(pri)
        pri.a()
        pri.b()
        //思考题
        var name = 'sz'
        var sss = {
            name:'szsk',
            getName:function(){
                console.log(this)//getName()
                // 若想匿名函数的this 指向本对象
                var that = this 
                return function(){
                    console.log(this)//window
                    console.log(this.name)//sz
                    console.log(that.name)//szsk
                }
            }
        }
        //sss.getName()()
        var aas=sss.getName()
        aas()

        var username = 'jac';
        function clicks(){
            console.log(this.username)//jac
            console.log(username)//undefind
            var username = 'tom';
            console.log(username)
        }
        clicks()


        var abt = function (val, index) {
            console.log(val,index);
            return {
                fn: function (name) {
                   // console.log(name)
                    return abt(name, val);
                }
            }
        }
        var b1 = abt(5); // underfined
        // console.log(abt)
        b1.fn(1); // 0
        b1.fn(2); // 0
        b1.fn(3); // 0
        
        for(var i=0;i<5;i++){
            setTimeout(function(i){
                console.log(i)
            }(i),i*1000)
            // console.log(i)
            // (function(){
            //     setTimeout(function(){
            //     console.log(i)
            //     },i*1000)
            // })(i)
        }
    </script>
</body>
</html>